## Issue #111: Course Planner prototype (tracer bullet)

**Task completed**: Implemented core localStorage-based course planner with sections and lessons

**Key decisions**:
- Used `fractional-indexing` library for ordering (already installed)
- Created `Plan`, `Section`, `Lesson` types with id, title, order fields
- Lessons have a `notes` field for storing lesson notes
- Plans stored in localStorage under "course-plans" key
- SSR-safe localStorage access with `typeof localStorage !== "undefined"` checks
- Plan detail page allows inline editing of plan title, sections, and lessons
- Lesson detail page has auto-saving notes textarea (500ms debounce)

**Files changed**:
- app/features/course-planner/types.ts - New types for Plan, Section, Lesson
- app/hooks/use-plans.ts - New hook for localStorage CRUD operations
- app/components/create-plan-modal.tsx - Modal for creating new plans
- app/components/app-sidebar.tsx - Added Plans collapsible group with context menu delete
- app/routes/plans.$planId.tsx - Plan detail page with section/lesson management
- app/routes/plans.$planId.lessons.$lessonId.tsx - Lesson detail page with notes textarea

**Blockers**: None

**Remaining work for Issue #111**:
- Drag-and-drop reordering for sections and lessons (requires @dnd-kit integration)

---

## Issue #111: Plan rename via context menu (US3)

**Task completed**: Added right-click rename functionality for plans in sidebar

**Key decisions**:
- Inline editing approach: right-click shows "Rename" option, which replaces the plan button with an input field
- Save on Enter key or blur, cancel on Escape
- Uses same `updatePlan` function from `usePlans` hook (already existed)
- Used `useRef` + `useEffect` to auto-focus and select text when rename mode activates

**Files changed**:
- app/components/app-sidebar.tsx - Added PencilIcon, Input import; state for rename mode; Rename context menu item

**Blockers**: None

---

## Issue #111: Drag-and-drop reordering for sections and lessons (US8, US12, US13)

**Task completed**: Added drag-and-drop functionality for reordering sections and lessons

**Key decisions**:
- Installed `@dnd-kit/core` and `@dnd-kit/sortable` for drag-and-drop
- Used existing `reorderSection` and `reorderLesson` functions from `usePlans` hook
- Created `SortableSection` and `SortableLesson` wrapper components with `useSortable` hook
- Added drag handles (GripVertical icon) - visible on hover for lessons, always visible for sections
- Lessons can be reordered within a section or moved between sections
- DragOverlay shows a preview of the dragged item
- 8px activation distance prevents accidental drags when clicking

**Files changed**:
- package.json - Added @dnd-kit/core, @dnd-kit/sortable dependencies
- app/routes/plans.$planId.tsx - Wrapped sections in DndContext, created SortableSection and SortableLesson components

**Blockers**: None

---

## Issue #112: Fix lesson reordering crash (Zz >= Zz error)

**Task completed**: Fixed crash when reordering lessons with duplicate order keys

**Key decisions**:
- Added defensive check in `reorderLesson` and `reorderSection` for when `beforeOrder === afterOrder`
- When duplicate order keys are detected, generate a new key after the duplicate instead of between them
- This handles data corruption gracefully rather than crashing

**Files changed**:
- app/hooks/use-plans.ts - Added duplicate order key handling in reorderLesson and reorderSection

**Blockers**: None

---

## Issue #115: Remove fractional indexing from plans area

**Task completed**: Replaced fractional indexing with simple integer-based ordering for plans

**Key decisions**:
- Changed `order` field from `string` to `number` in Section and Lesson types
- Removed `fractional-indexing` import from use-plans.ts (library still used elsewhere for videos)
- Reordering now uses array-based splice/insert then reassigns sequential integers (0, 1, 2...)
- Adding new items uses `Math.max(...orders) + 1` instead of generateKeyBetween
- Simpler, bug-free approach since all data is in local state anyway

**Files changed**:
- app/features/course-planner/types.ts - Changed order from string to number
- app/hooks/use-plans.ts - Removed fractional-indexing, rewrote reorder functions
- app/routes/plans.$planId.tsx - Changed sorting from localeCompare to numeric comparison

**Blockers**: None

---

## Issue #114: Show sidebar on plans pages

**Task completed**: Added AppSidebar to plan detail and lesson detail pages

**Key decisions**:
- Made AppSidebar props optional with default empty arrays/null values
- Added optional chaining for setIsAddRepoModalOpen and setIsAddStandaloneVideoModalOpen
- Conditionally render AddRepoModal and AddStandaloneVideoModal only when their setters are provided
- Plans section of sidebar works standalone via usePlans hook (localStorage)

**Files changed**:
- app/components/app-sidebar.tsx - Made all props optional with defaults
- app/routes/plans.$planId.tsx - Added AppSidebar to both normal and "not found" returns
- app/routes/plans.$planId.lessons.$lessonId.tsx - Added AppSidebar to both normal and "not found" returns

**Blockers**: None

---

## Issue #113: Hide add section input behind plus button

**Task completed**: Changed add section UI from always-visible input to button that reveals input on click

**Key decisions**:
- Added `isAddingSectionOpen` state to control visibility
- Default state shows a dashed outline button with "Add Section" text
- Clicking button reveals input with Add/Cancel buttons
- Escape key cancels and hides the input
- Enter key submits (existing behavior)
- Input closes automatically after successful add

**Files changed**:
- app/routes/plans.$planId.tsx - Added isAddingSectionOpen state, updated add section UI with conditional rendering

**Blockers**: None

---

## Issue #116: Fix cross-section lesson drag to specific position

**Task completed**: Improved collision detection to allow dropping lessons at specific positions in other sections

**Key decisions**:
- Created custom collision detection that combines `pointerWithin` and `closestCenter`
- Prioritizes lessons over sections when pointer is inside a lesson element
- Added `data: { type: "section" }` to section sortables to distinguish them from lessons
- When dragging over a lesson in another section, that lesson is detected as the drop target

**Files changed**:
- app/routes/plans.$planId.tsx - Added customCollisionDetection function, marked sections with type data

**Blockers**: None

---

## Issue #117: Focus Add Lesson button after creating lesson/section

**Task completed**: Add Lesson button is now focused after creating a lesson or section for quick keyboard-driven workflows

**Key decisions**:
- Added `focusAddLessonInSection` state to track which section's button should be focused
- Added `shouldFocusAddLesson` and `onAddLessonFocused` props to SortableSection
- Used `useRef` and `useEffect` to focus the button when the flag is set
- Focus is triggered after both lesson creation (same section) and section creation (new section)

**Files changed**:
- app/routes/plans.$planId.tsx - Added focus logic with ref, state, and props threading

**Blockers**: None

---

## Issue #118: Replace lesson notes with inline description

**Task completed**: Replaced separate notes page with inline description editing on lessons

**Key decisions**:
- Renamed `notes` field to `description` in Lesson type
- Deleted lesson detail page (`plans.$planId.lessons.$lessonId.tsx`)
- Added inline description display/editing to SortableLesson component
- Description shows under lesson title (or "Add description" link if empty)
- Click on description or "Add description" opens textarea editor inline
- Supports Escape to cancel, Save/Cancel buttons

**Files changed**:
- app/features/course-planner/types.ts - Renamed notes to description
- app/hooks/use-plans.ts - Updated notes references to description
- app/routes/plans.$planId.tsx - Added inline description editing to lessons, removed Link to lesson detail
- Deleted: app/routes/plans.$planId.lessons.$lessonId.tsx

**Blockers**: None

---

## Issue #119: Hide edit buttons on hover, show grip handles always

**Task completed**: Adjusted visibility of edit/delete buttons and grip handles

**Key decisions**:
- Section edit/delete buttons: now hidden by default, visible on section hover (using group/section)
- Plan title edit button: now hidden by default, visible on hover (using group/title)
- Lesson grip handles: now always visible (removed opacity-0 group-hover:opacity-100)
- Lesson edit/delete buttons: remain hidden until hover (unchanged)

**Files changed**:
- app/routes/plans.$planId.tsx - Updated CSS classes for hover visibility

**Blockers**: None

---

## Issue #120: Rename repos to courses in sidebar

**Task completed**: Changed "Repos" to "Courses" in sidebar display

**Key decisions**:
- Simple text replacement in sidebar component
- Does not change any URLs or internal naming (as per requirements)

**Files changed**:
- app/components/app-sidebar.tsx - Changed "Repos" to "Courses", "Archived Repos" to "Archived Courses"

**Blockers**: None

---

## Issue #121: Add section numbers

**Task completed**: Added section numbers (1., 2., 3., etc.) next to section titles

**Key decisions**:
- Added `sectionNumber` prop to SortableSectionProps interface
- Pass `index + 1` when mapping over sortedSections
- Display number before title as muted-foreground text with "." suffix
- Numbers automatically update when sections are reordered

**Files changed**:
- app/routes/plans.$planId.tsx - Added sectionNumber prop and display

**Blockers**: None

---

## Issue #122: Ctrl+Space saves description

**Task completed**: Added Ctrl+Space keyboard shortcut to save description while editing

**Key decisions**:
- Added check for `e.key === " " && e.ctrlKey` in description textarea onKeyDown
- Prevents default behavior to avoid inserting space
- Consistent with escape-to-cancel pattern already in place

**Files changed**:
- app/routes/plans.$planId.tsx - Added Ctrl+Space handling in description Textarea

**Blockers**: None

---

## Issue #123: Add lesson numbers (1.1, 1.2, etc.)

**Task completed**: Added lesson numbers showing section.lesson format

**Key decisions**:
- Added `lessonNumber` prop to SortableLessonProps (string type for "1.1" format)
- Pass `${sectionNumber}.${lessonIndex + 1}` when mapping lessons
- Display number before lesson title in muted-foreground style
- Numbers update automatically when lessons are reordered or moved between sections

**Files changed**:
- app/routes/plans.$planId.tsx - Added lessonNumber prop and display

**Blockers**: None

---

## Issue #124: Add lesson icon selector

**Task completed**: Added clickable icon to lessons for choosing between watch (passive) and code (interactive) lesson types

**Key decisions**:
- Added `LessonIcon` type ("watch" | "code") and optional `icon` field to Lesson type
- Monitor icon = passive exercise (sit back and watch), Code icon = interactive (hands-on coding)
- Default is "watch" (Monitor icon) when no icon is set
- Click icon to toggle between the two options
- Icon appears between grip handle and lesson number
- Hover shows tooltip explaining the current state and that it's clickable

**Files changed**:
- app/features/course-planner/types.ts - Added LessonIcon type and icon field to Lesson
- app/hooks/use-plans.ts - Updated updateLesson to allow icon updates
- app/routes/plans.$planId.tsx - Added icon selector UI with Monitor and Code icons from lucide-react

**Blockers**: None

---

## Issue #125: Reduce Add Lesson button to plus icon only

**Task completed**: Changed Add Lesson button from text + icon to icon-only

**Key decisions**:
- Changed button from `size="sm"` to `size="icon"` with `h-6 w-6` dimensions
- Removed "Add Lesson" text, kept only the Plus icon
- Cleaner, less cluttered UI while maintaining functionality

**Files changed**:
- app/routes/plans.$planId.tsx - Simplified Add Lesson button to icon-only

**Blockers**: None

---

## Issue #126: Reposition lesson icon and make it brighter

**Task completed**: Moved lesson icon after the number and changed color to foreground

**Key decisions**:
- Reordered elements: grip → number → icon → title (was: grip → icon → number → title)
- Changed icon color from `text-muted-foreground` to `text-foreground` for better visibility
- Separated number into its own span element for cleaner layout

**Files changed**:
- app/routes/plans.$planId.tsx - Reordered lesson elements and updated icon color

**Blockers**: None

---

## Issue #127: Move lesson icon to separate column

**Task completed**: Refactored lesson layout to two-column design with prominent icon on left

**Key decisions**:
- Changed SortableLesson from single-row layout to two-column layout using flex with gap-3
- Left column: Large clickable icon (w-6 h-6, up from w-4 h-4) aligned to top of content
- Right column: Title row (grip, number, title, edit buttons) and description below
- Icon spans both title and description visually, creating a more prominent presence
- Removed `ml-6` indentation from description since it now aligns naturally under title
- Added `self-start mt-0.5` to icon button for proper vertical alignment with title text

**Files changed**:
- app/routes/plans.$planId.tsx - Restructured SortableLesson component layout

**Blockers**: None

---

## Issue #128: Create icon prototype page with multiple treatments

**Task completed**: Created prototype page at /icon-prototype with four different icon treatments

**Key decisions**:
- Variant 1 (Current): Large 24px icon in separate left column - prominent and visual
- Variant 2 (Inline Small): Small 16px icon inline between number and title - subtle and compact
- Variant 3 (Colored Badge): Icon with colored background (blue for code, purple for watch)
- Variant 4 (Labeled Pill): Small pill with icon + text label after title - explicit but verbose
- Page includes both a grid comparison and full section preview for each variant
- Used mock data with 4 lessons showing both icon types and with/without descriptions

**Files changed**:
- app/routes/icon-prototype.tsx - New prototype page with 4 icon treatment variants

**Blockers**: None

---

## Issue #128: Implement Circle Badge icon design and remove prototype

**Task completed**: Applied Circle Badge design to plan page and deleted prototype

**Key decisions**:
- Chose Circle Badge variant (Variant 12 from expanded prototype with 12 options)
- Layout: grip handle → circle badge icon → number + title
- Icon in 28px colored circle: yellow (`bg-yellow-500/20 text-yellow-600`) for code, purple (`bg-purple-500/20 text-purple-600`) for watch
- Uses Code and Play icons
- Deleted prototype page after design was finalized

**Files changed**:
- app/routes/plans.$planId.tsx - Updated SortableLesson to Circle Badge layout
- app/routes/icon-prototype.tsx - Deleted

**Blockers**: None

---

## Issue #130: Add third icon (green discussion/conversation)

**Task completed**: Added a third lesson icon type for discussions, colored green

**Key decisions**:
- Extended `LessonIcon` type to include "discussion" alongside "watch" and "code"
- Used `MessageCircle` icon from lucide-react for the discussion type
- Green color scheme: `bg-green-500/20 text-green-600` (consistent with existing yellow/purple pattern)
- Icon click cycles through: watch → code → discussion → watch
- Tooltip shows "Discussion (click to change)" for the new icon type

**Files changed**:
- app/features/course-planner/types.ts - Added "discussion" to LessonIcon type
- app/routes/plans.$planId.tsx - Added MessageCircle import, updated icon rendering and cycle logic

**Blockers**: None

---

## Issue #129: Add ability to duplicate a plan with context menu

**Task completed**: Added actions dropdown menu to plan title with Edit Title and Duplicate Plan options

**Key decisions**:
- Replaced pencil icon next to plan title with a MoreVertical icon triggering a dropdown menu
- Dropdown menu contains "Edit Title" (existing functionality, now in menu) and "Duplicate Plan" (new)
- Added `duplicatePlan` function to `usePlans` hook that deep copies plan with all sections and lessons
- Duplicated plan gets title suffixed with "(Copy)" and new IDs for all sections/lessons
- After duplication, user is navigated to the new plan

**Files changed**:
- app/hooks/use-plans.ts - Added duplicatePlan function
- app/routes/plans.$planId.tsx - Replaced pencil Button with DropdownMenu, added duplicate functionality

**Blockers**: None

---

## Issue #131: Pre-load plan in clientLoader

**Task completed**: Added clientLoader to plan page to prevent "not found" flash

**Key decisions**:
- Added `clientLoader` export that reads plans from localStorage before component renders
- Component uses `loaderData.plan` from clientLoader as initial value
- Falls back to `getPlan` from hook for subsequent updates (after mutations)
- Removed `useParams` usage since planId comes from loaderData

**Files changed**:
- app/routes/plans.$planId.tsx - Added clientLoader, updated component to use loaderData

**Blockers**: None

---

## Issue #132: Add JSON file backup for plans

**Task completed**: Plans are now backed up to a JSON file whenever localStorage is updated

**Key decisions**:
- Created `/api/plans/backup` endpoint that writes plans to `plans-backup.json` in repo root
- Used Effect and @effect/platform FileSystem for file operations (consistent with other API routes)
- Backup is fire-and-forget (non-blocking) - localStorage remains primary store
- Backup file is git-ignored so it stays local but can be manually restored if needed
- JSON is formatted with 2-space indentation for readability

**Files changed**:
- app/routes/api.plans.backup.ts - New API endpoint for JSON backup
- app/hooks/use-plans.ts - Added fetch call to backup API in useEffect
- .gitignore - Added plans-backup.json

**Blockers**: None

---

## Issue #133: Limit description width to 65 characters

**Task completed**: Added max-width constraint to lesson descriptions

**Key decisions**:
- Added `max-w-[65ch]` class to the description div in SortableLesson component
- 65ch is approximately 65 characters wide, improving readability for long descriptions

**Files changed**:
- app/routes/plans.$planId.tsx - Added max-w-[65ch] to description display

**Blockers**: None

---

## Issue #134: Click-to-edit for titles

**Task completed**: Clicking on titles now enters edit mode for plan, section, and lesson titles

**Key decisions**:
- Plan title: h1 element is now clickable with hover effect (`hover:text-muted-foreground`)
- Section title: h2 element is now clickable with hover effect, removed pencil icon
- Lesson title: title div is now clickable with hover effect, removed pencil icon
- Removed "Edit Title" from plan dropdown menu (clicking title handles this now)
- Kept dropdown menu for "Duplicate Plan" functionality
- Removed PencilIcon import as it's no longer used

**Files changed**:
- app/routes/plans.$planId.tsx - Made titles clickable, removed pencil icons

**Blockers**: None

---

## Issue #135: Estimated video count at top of plan

**Task completed**: Added estimated video count to plan header stats

**Key decisions**:
- Video count calculated based on lesson icons: play/watch=1, code=2, discussion=1
- Displayed with ~ prefix to indicate estimate (e.g., "~12 videos")
- Added alongside existing "X sections" and "Y lessons" stats

**Files changed**:
- app/routes/plans.$planId.tsx - Added estimatedVideos calculation and display

**Blockers**: None

---

## Issue #137: Dependency prototype page

**Task completed**: Created prototype page at /dependency-prototype with 5 different UI treatments for lesson dependencies

**Key decisions**:
- Created extended `LessonWithDeps` interface adding `dependencies: string[]` field
- 5 UI variants implemented:
  1. Badge Pills - Dependencies as small removable badges under title
  2. Inline Dropdown - Compact dropdown on right with checkbox selection
  3. Visual Lines - Vertical lines connecting dependent lessons
  4. Expandable Row - Click to expand and see/edit dependencies
  5. Warning Banner - Violations shown as prominent banner at top
- Order violation detection: warns when a lesson depends on another that comes later
- Side-by-side comparison of valid order vs violation state for each variant
- Mock data with 6 lessons across 2 sections demonstrating dependencies

**Files changed**:
- app/routes/dependency-prototype.tsx - New prototype page with 5 dependency UI variants

**Blockers**: None

---

## Issue #136: Auto-capitalize lesson and section titles

**Task completed**: Titles are now automatically capitalized when saved

**Key decisions**:
- Created `capitalizeTitle` helper function that capitalizes the first letter of each word
- Applied to all title save operations: addSection, updateSection, addLesson, updateLesson
- Users can type in lowercase and titles will be capitalized on save

**Files changed**:
- app/routes/plans.$planId.tsx - Added capitalizeTitle function and applied to all title handlers

**Blockers**: None

---

## Issue #138: Fix lesson icon not changing on first click

**Task completed**: Fixed bug where clicking icon on newly created lesson didn't change the icon

**Key decisions**:
- Root cause: New lessons are created without an `icon` field (it's optional)
- When `lesson.icon` is `undefined`, the display correctly shows the Play (watch) icon as default
- But the click handler's cycle logic `lesson.icon === "watch" ? "code" : ...` didn't match `undefined`
- So clicking cycled from `undefined` to `"watch"` - visually no change since both render as Play icon
- Fix: Added `|| lesson.icon === undefined` to treat undefined same as "watch" in the cycle logic
- Now clicking on a new lesson's icon correctly cycles to "code" (yellow)

**Files changed**:
- app/routes/plans.$planId.tsx - Updated icon click handler to treat undefined as "watch"

**Blockers**: None

---

## Issue #137: Rewrite dependency prototype with full lesson UI

**Task completed**: Rewrote dependency prototype to include all UI elements from the actual plan page

**Key decisions**:
- Created `LessonRow` base component matching actual plan page UI (grip handle, circle badge icon, title, description, delete button)
- Created `LessonRowWithTitleSlot` variant for placing elements inline with title
- All 5 variants now use the base components for consistent UI
- Variant 2 (Inline Dropdown) updated to show dependency badge inline with title (not below)
- Badge shows just link icon when no deps, link icon + lesson numbers when has deps
- Mock data updated to include descriptions on some lessons
- Replaced Variant 4 "Expandable Row" with "Subtle Text" variant

**Files changed**:
- app/routes/dependency-prototype.tsx - Complete rewrite with full lesson UI

**Blockers**: None

**Next step**: Issue #139 created to implement Variant 2 and delete prototype

---

## Issue #139: Implement lesson dependencies with inline dropdown UI

**Task completed**: Added dependencies field to lessons with inline dropdown UI for editing

**Key decisions**:
- Added optional `dependencies: string[]` field to Lesson type (array of lesson IDs)
- Updated `updateLesson` in usePlans hook to accept dependencies updates
- Updated `deleteLesson` to clean up deleted lessons from other lessons' dependencies
- Created `FlattenedLesson` interface for dependency dropdown (id, number, title, sectionId)
- Created `checkDependencyViolation` helper to detect when a lesson depends on one that comes later
- Inline dropdown badge shows: muted link icon (no deps), blue with lesson numbers (has deps), amber with warning (violation)
- Dependencies can span sections (e.g., 2.1 can depend on 1.3)
- Deleted prototype page after implementation

**Files changed**:
- app/features/course-planner/types.ts - Added dependencies field to Lesson
- app/hooks/use-plans.ts - Updated updateLesson and deleteLesson for dependencies
- app/routes/plans.$planId.tsx - Added inline dropdown UI and violation detection
- app/routes/dependency-prototype.tsx - Deleted

**Blockers**: None

---

## Issue #140: Remove blue color from dependencies

**Task completed**: Dependencies badge is now gray by default, only orange on error

**Key decisions**:
- Removed the blue styling (`bg-blue-500/20 text-blue-600`) for dependencies without violations
- Dependencies now use gray text (`text-muted-foreground hover:text-foreground`) unless there's a violation
- Violations still show amber/orange styling (`bg-amber-500/20 text-amber-600`)

**Files changed**:
- app/routes/plans.$planId.tsx - Simplified dependency badge styling conditional

**Blockers**: None

---

## Issue #141: Migrate Plans from localStorage to Postgres (tracer bullet)

**Task completed**: Added Drizzle schema tables and sync endpoint for plans

**Key decisions**:
- Created `plan`, `plan_section`, `plan_lesson` tables with cascade deletes
- Used doublePrecision for order field (matching PRD spec for integer ordering)
- Created `getPlans` method in DBService that returns plans in frontend format
- Created `syncPlans` method using delete-all + insert-all pattern (last write wins)
- Created POST `/api/plans/sync` endpoint with Effect Schema validation
- This is the tracer bullet - schema and sync endpoint are ready, hook integration pending

**Files changed**:
- app/db/schema.ts - Added plans, planSections, planLessons tables with relations
- app/services/db-service.ts - Added getPlans and syncPlans methods
- app/routes/api.plans.sync.ts - New sync endpoint

**Blockers**: None

**Remaining work for Issue #141**:
- Add debounced sync (750ms) to usePlans hook
- Load plans via root layout loader (for sidebar availability)
- Create migration endpoint to move localStorage → Postgres
- Add error banner for sync failures
- Run db:push when database is available

---

## Issue #141: Update usePlans hook to sync to Postgres

**Task completed**: Changed backup endpoint to sync endpoint in usePlans hook

**Key decisions**:
- Changed fetch URL from `/api/plans/backup` to `/api/plans/sync`
- Request body format `{ plans }` is identical between both endpoints
- Kept localStorage as primary store (sync is fire-and-forget for now)
- Added TODO comment for future error banner work

**Files changed**:
- app/hooks/use-plans.ts - Updated endpoint URL from backup to sync

**Blockers**: None

---

## Issue #141: Load plans from Postgres via server loaders

**Task completed**: Plans now load from Postgres via server loaders and are passed to AppSidebar/usePlans

**Key decisions**:
- Created GET `/api/plans` endpoint using DBService.getPlans()
- Updated `usePlans` hook to accept `initialPlans` option from server loader
- Added debounced sync (750ms) to avoid overwhelming DB with rapid changes
- Skip initial sync on mount to prevent syncing server data back to server
- Updated `_index.tsx` loader to fetch plans and pass to AppSidebar
- Converted `plans.$planId.tsx` from clientLoader to server loader
- Both pages now pass `initialPlans` prop to AppSidebar

**Files changed**:
- app/routes/api.plans.ts - New GET endpoint for loading plans
- app/hooks/use-plans.ts - Added UsePlansOptions, initialPlans param, debounced sync
- app/components/app-sidebar.tsx - Added initialPlans prop, pass to usePlans
- app/routes/_index.tsx - Loader fetches plans, passes to AppSidebar
- app/routes/plans.$planId.tsx - Converted to server loader, passes plans to usePlans and AppSidebar

**Blockers**: None

**Remaining work for Issue #141**:
- Add error banner for sync failures
- Run db:push when database is available

---

## Issue #141: Add localStorage to Postgres migration endpoint

**Task completed**: Created migration endpoint and automatic migration trigger

**Key decisions**:
- Created POST `/api/plans/migrate` endpoint that only migrates if DB is empty
- Added one-time migration effect in usePlans hook triggered on mount
- Uses `course-plans-migration-attempted` localStorage flag to prevent repeated attempts
- On successful migration, removes `course-plans` from localStorage
- On network error, doesn't mark as attempted so it can retry on next load
- Migration is fire-and-forget (non-blocking for UI)

**Files changed**:
- app/routes/api.plans.migrate.ts - New migration endpoint
- app/hooks/use-plans.ts - Added migration effect and MIGRATION_ATTEMPTED_KEY constant

**Blockers**: None

---

## Issue #141: Add sync error banner for plans

**Task completed**: Added error state tracking and error banner UI for sync failures

**Key decisions**:
- Added `syncError` state (string | null) to usePlans hook to track sync failures
- Added `retrySync` callback function for manual retry from error banner
- Updated fetch call to check response.ok and extract error messages
- Successful sync clears any existing error state
- Error banner shows at top of plan page with destructive styling
- Banner includes error message and Retry button with refresh icon

**Files changed**:
- app/hooks/use-plans.ts - Added syncError state, syncPlans function, retrySync callback
- app/routes/plans.$planId.tsx - Added error banner UI with retry functionality

**Blockers**: None

**Remaining work for Issue #141**:
- Run db:push when database is available

---

## Issue #142: Sync only the active plan instead of all plans

**Task completed**: Changed sync endpoint to only synchronize a single plan at a time

**Key decisions**:
- Added `syncPlan` method to DBService that deletes and re-inserts a single plan by ID
- Changed `/api/plans/sync` endpoint from accepting `{ plans: Plan[] }` to `{ plan: Plan }`
- Added `activePlanId` option to `usePlans` hook to specify which plan to sync
- Updated debounced sync effect to only sync when `activePlanId` is provided and only sync that plan
- Plan detail page now passes `activePlanId: loaderData.plan?.id` to the hook
- Sidebar usage (no activePlanId) no longer triggers syncs on plan list changes

**Files changed**:
- app/services/db-service.ts - Added syncPlan method for single plan sync
- app/routes/api.plans.sync.ts - Changed schema from plans array to single plan
- app/hooks/use-plans.ts - Added activePlanId option, updated sync logic
- app/routes/plans.$planId.tsx - Pass activePlanId to usePlans hook

**Blockers**: None

---

## Issue #143: Remove localStorage migration code

**Task completed**: Removed the localStorage to Postgres migration endpoint and related code

**Key decisions**:
- Migration is no longer needed since plans are now stored in Postgres
- Removed STORAGE_KEY and MIGRATION_ATTEMPTED_KEY constants from usePlans hook
- Removed localStorage fallback in usePlans useState initializer
- Removed the one-time migration useEffect from usePlans hook
- Removed syncPlans (bulk sync) method from DBService since it was only used by migrate endpoint

**Files deleted**:
- app/routes/api.plans.migrate.ts - The migration endpoint

**Files changed**:
- app/hooks/use-plans.ts - Removed localStorage fallback, migration code, and related constants
- app/services/db-service.ts - Removed syncPlans method

**Blockers**: None

---

## Issue #144: Fix plan creation from sidebar (tracer bullet)

**Task completed**: Converted plan creation from local state to server action with redirect

**Key decisions**:
- Created POST `/api/plans` action endpoint that creates plan in Postgres and redirects to plan page
- Updated CreatePlanModal to use `useFetcher` with form submission instead of callback
- Changed AppSidebar from using `usePlans` hook to receiving `plans` prop from server loader
- Added `/api/plans/$planId/delete` and `/api/plans/$planId/rename` endpoints for sidebar operations
- Added `deletePlan` and `renamePlan` methods to DBService
- All sidebar plan operations now use fetchers posting to server actions

**Files created**:
- app/routes/api.plans.$planId.delete.ts - Endpoint for deleting plans
- app/routes/api.plans.$planId.rename.ts - Endpoint for renaming plans

**Files changed**:
- app/routes/api.plans.ts - Added action for plan creation with redirect
- app/components/create-plan-modal.tsx - Converted to useFetcher form
- app/components/app-sidebar.tsx - Removed usePlans hook, uses plans prop, fetchers for mutations
- app/services/db-service.ts - Added deletePlan and renamePlan methods
- app/routes/_index.tsx - Changed initialPlans to plans prop
- app/routes/plans.$planId.tsx - Changed initialPlans to plans prop
- app/routes/archived-repos.tsx - Added plans to loader and sidebar

**Blockers**: None

---

## Issue #147: Redirect home after deleting a plan

**Task completed**: User is now redirected home when deleting a plan they're currently viewing

**Key decisions**:
- Track the plan being deleted with `deletingPlanId` state
- After fetcher returns to idle state, check if current URL matches the deleted plan
- If on the deleted plan's page, navigate to "/"
- Clear `deletingPlanId` after handling to prevent stale redirects

**Files changed**:
- app/components/app-sidebar.tsx - Added useLocation, deletingPlanId state, redirect effect

**Blockers**: None

