## Issue #111: Course Planner prototype (tracer bullet)

**Task completed**: Implemented core localStorage-based course planner with sections and lessons

**Key decisions**:
- Used `fractional-indexing` library for ordering (already installed)
- Created `Plan`, `Section`, `Lesson` types with id, title, order fields
- Lessons have a `notes` field for storing lesson notes
- Plans stored in localStorage under "course-plans" key
- SSR-safe localStorage access with `typeof localStorage !== "undefined"` checks
- Plan detail page allows inline editing of plan title, sections, and lessons
- Lesson detail page has auto-saving notes textarea (500ms debounce)

**Files changed**:
- app/features/course-planner/types.ts - New types for Plan, Section, Lesson
- app/hooks/use-plans.ts - New hook for localStorage CRUD operations
- app/components/create-plan-modal.tsx - Modal for creating new plans
- app/components/app-sidebar.tsx - Added Plans collapsible group with context menu delete
- app/routes/plans.$planId.tsx - Plan detail page with section/lesson management
- app/routes/plans.$planId.lessons.$lessonId.tsx - Lesson detail page with notes textarea

**Blockers**: None

**Remaining work for Issue #111**:
- Drag-and-drop reordering for sections and lessons (requires @dnd-kit integration)

---

## Issue #111: Plan rename via context menu (US3)

**Task completed**: Added right-click rename functionality for plans in sidebar

**Key decisions**:
- Inline editing approach: right-click shows "Rename" option, which replaces the plan button with an input field
- Save on Enter key or blur, cancel on Escape
- Uses same `updatePlan` function from `usePlans` hook (already existed)
- Used `useRef` + `useEffect` to auto-focus and select text when rename mode activates

**Files changed**:
- app/components/app-sidebar.tsx - Added PencilIcon, Input import; state for rename mode; Rename context menu item

**Blockers**: None

---

## Issue #111: Drag-and-drop reordering for sections and lessons (US8, US12, US13)

**Task completed**: Added drag-and-drop functionality for reordering sections and lessons

**Key decisions**:
- Installed `@dnd-kit/core` and `@dnd-kit/sortable` for drag-and-drop
- Used existing `reorderSection` and `reorderLesson` functions from `usePlans` hook
- Created `SortableSection` and `SortableLesson` wrapper components with `useSortable` hook
- Added drag handles (GripVertical icon) - visible on hover for lessons, always visible for sections
- Lessons can be reordered within a section or moved between sections
- DragOverlay shows a preview of the dragged item
- 8px activation distance prevents accidental drags when clicking

**Files changed**:
- package.json - Added @dnd-kit/core, @dnd-kit/sortable dependencies
- app/routes/plans.$planId.tsx - Wrapped sections in DndContext, created SortableSection and SortableLesson components

**Blockers**: None

---

## Issue #112: Fix lesson reordering crash (Zz >= Zz error)

**Task completed**: Fixed crash when reordering lessons with duplicate order keys

**Key decisions**:
- Added defensive check in `reorderLesson` and `reorderSection` for when `beforeOrder === afterOrder`
- When duplicate order keys are detected, generate a new key after the duplicate instead of between them
- This handles data corruption gracefully rather than crashing

**Files changed**:
- app/hooks/use-plans.ts - Added duplicate order key handling in reorderLesson and reorderSection

**Blockers**: None

---

## Issue #115: Remove fractional indexing from plans area

**Task completed**: Replaced fractional indexing with simple integer-based ordering for plans

**Key decisions**:
- Changed `order` field from `string` to `number` in Section and Lesson types
- Removed `fractional-indexing` import from use-plans.ts (library still used elsewhere for videos)
- Reordering now uses array-based splice/insert then reassigns sequential integers (0, 1, 2...)
- Adding new items uses `Math.max(...orders) + 1` instead of generateKeyBetween
- Simpler, bug-free approach since all data is in local state anyway

**Files changed**:
- app/features/course-planner/types.ts - Changed order from string to number
- app/hooks/use-plans.ts - Removed fractional-indexing, rewrote reorder functions
- app/routes/plans.$planId.tsx - Changed sorting from localeCompare to numeric comparison

**Blockers**: None

---

## Issue #114: Show sidebar on plans pages

**Task completed**: Added AppSidebar to plan detail and lesson detail pages

**Key decisions**:
- Made AppSidebar props optional with default empty arrays/null values
- Added optional chaining for setIsAddRepoModalOpen and setIsAddStandaloneVideoModalOpen
- Conditionally render AddRepoModal and AddStandaloneVideoModal only when their setters are provided
- Plans section of sidebar works standalone via usePlans hook (localStorage)

**Files changed**:
- app/components/app-sidebar.tsx - Made all props optional with defaults
- app/routes/plans.$planId.tsx - Added AppSidebar to both normal and "not found" returns
- app/routes/plans.$planId.lessons.$lessonId.tsx - Added AppSidebar to both normal and "not found" returns

**Blockers**: None

---

## Issue #113: Hide add section input behind plus button

**Task completed**: Changed add section UI from always-visible input to button that reveals input on click

**Key decisions**:
- Added `isAddingSectionOpen` state to control visibility
- Default state shows a dashed outline button with "Add Section" text
- Clicking button reveals input with Add/Cancel buttons
- Escape key cancels and hides the input
- Enter key submits (existing behavior)
- Input closes automatically after successful add

**Files changed**:
- app/routes/plans.$planId.tsx - Added isAddingSectionOpen state, updated add section UI with conditional rendering

**Blockers**: None

---

## Issue #116: Fix cross-section lesson drag to specific position

**Task completed**: Improved collision detection to allow dropping lessons at specific positions in other sections

**Key decisions**:
- Created custom collision detection that combines `pointerWithin` and `closestCenter`
- Prioritizes lessons over sections when pointer is inside a lesson element
- Added `data: { type: "section" }` to section sortables to distinguish them from lessons
- When dragging over a lesson in another section, that lesson is detected as the drop target

**Files changed**:
- app/routes/plans.$planId.tsx - Added customCollisionDetection function, marked sections with type data

**Blockers**: None

---

## Issue #117: Focus Add Lesson button after creating lesson/section

**Task completed**: Add Lesson button is now focused after creating a lesson or section for quick keyboard-driven workflows

**Key decisions**:
- Added `focusAddLessonInSection` state to track which section's button should be focused
- Added `shouldFocusAddLesson` and `onAddLessonFocused` props to SortableSection
- Used `useRef` and `useEffect` to focus the button when the flag is set
- Focus is triggered after both lesson creation (same section) and section creation (new section)

**Files changed**:
- app/routes/plans.$planId.tsx - Added focus logic with ref, state, and props threading

**Blockers**: None

---

## Issue #118: Replace lesson notes with inline description

**Task completed**: Replaced separate notes page with inline description editing on lessons

**Key decisions**:
- Renamed `notes` field to `description` in Lesson type
- Deleted lesson detail page (`plans.$planId.lessons.$lessonId.tsx`)
- Added inline description display/editing to SortableLesson component
- Description shows under lesson title (or "Add description" link if empty)
- Click on description or "Add description" opens textarea editor inline
- Supports Escape to cancel, Save/Cancel buttons

**Files changed**:
- app/features/course-planner/types.ts - Renamed notes to description
- app/hooks/use-plans.ts - Updated notes references to description
- app/routes/plans.$planId.tsx - Added inline description editing to lessons, removed Link to lesson detail
- Deleted: app/routes/plans.$planId.lessons.$lessonId.tsx

**Blockers**: None

---

## Issue #119: Hide edit buttons on hover, show grip handles always

**Task completed**: Adjusted visibility of edit/delete buttons and grip handles

**Key decisions**:
- Section edit/delete buttons: now hidden by default, visible on section hover (using group/section)
- Plan title edit button: now hidden by default, visible on hover (using group/title)
- Lesson grip handles: now always visible (removed opacity-0 group-hover:opacity-100)
- Lesson edit/delete buttons: remain hidden until hover (unchanged)

**Files changed**:
- app/routes/plans.$planId.tsx - Updated CSS classes for hover visibility

**Blockers**: None

---

## Issue #120: Rename repos to courses in sidebar

**Task completed**: Changed "Repos" to "Courses" in sidebar display

**Key decisions**:
- Simple text replacement in sidebar component
- Does not change any URLs or internal naming (as per requirements)

**Files changed**:
- app/components/app-sidebar.tsx - Changed "Repos" to "Courses", "Archived Repos" to "Archived Courses"

**Blockers**: None

