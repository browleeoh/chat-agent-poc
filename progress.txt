## Issue #111: Course Planner prototype (tracer bullet)

**Task completed**: Implemented core localStorage-based course planner with sections and lessons

**Key decisions**:
- Used `fractional-indexing` library for ordering (already installed)
- Created `Plan`, `Section`, `Lesson` types with id, title, order fields
- Lessons have a `notes` field for storing lesson notes
- Plans stored in localStorage under "course-plans" key
- SSR-safe localStorage access with `typeof localStorage !== "undefined"` checks
- Plan detail page allows inline editing of plan title, sections, and lessons
- Lesson detail page has auto-saving notes textarea (500ms debounce)

**Files changed**:
- app/features/course-planner/types.ts - New types for Plan, Section, Lesson
- app/hooks/use-plans.ts - New hook for localStorage CRUD operations
- app/components/create-plan-modal.tsx - Modal for creating new plans
- app/components/app-sidebar.tsx - Added Plans collapsible group with context menu delete
- app/routes/plans.$planId.tsx - Plan detail page with section/lesson management
- app/routes/plans.$planId.lessons.$lessonId.tsx - Lesson detail page with notes textarea

**Blockers**: None

**Remaining work for Issue #111**:
- Drag-and-drop reordering for sections and lessons (requires @dnd-kit integration)

---

## Issue #111: Plan rename via context menu (US3)

**Task completed**: Added right-click rename functionality for plans in sidebar

**Key decisions**:
- Inline editing approach: right-click shows "Rename" option, which replaces the plan button with an input field
- Save on Enter key or blur, cancel on Escape
- Uses same `updatePlan` function from `usePlans` hook (already existed)
- Used `useRef` + `useEffect` to auto-focus and select text when rename mode activates

**Files changed**:
- app/components/app-sidebar.tsx - Added PencilIcon, Input import; state for rename mode; Rename context menu item

**Blockers**: None

---

## Issue #111: Drag-and-drop reordering for sections and lessons (US8, US12, US13)

**Task completed**: Added drag-and-drop functionality for reordering sections and lessons

**Key decisions**:
- Installed `@dnd-kit/core` and `@dnd-kit/sortable` for drag-and-drop
- Used existing `reorderSection` and `reorderLesson` functions from `usePlans` hook
- Created `SortableSection` and `SortableLesson` wrapper components with `useSortable` hook
- Added drag handles (GripVertical icon) - visible on hover for lessons, always visible for sections
- Lessons can be reordered within a section or moved between sections
- DragOverlay shows a preview of the dragged item
- 8px activation distance prevents accidental drags when clicking

**Files changed**:
- package.json - Added @dnd-kit/core, @dnd-kit/sortable dependencies
- app/routes/plans.$planId.tsx - Wrapped sections in DndContext, created SortableSection and SortableLesson components

**Blockers**: None

---

## Issue #112: Fix lesson reordering crash (Zz >= Zz error)

**Task completed**: Fixed crash when reordering lessons with duplicate order keys

**Key decisions**:
- Added defensive check in `reorderLesson` and `reorderSection` for when `beforeOrder === afterOrder`
- When duplicate order keys are detected, generate a new key after the duplicate instead of between them
- This handles data corruption gracefully rather than crashing

**Files changed**:
- app/hooks/use-plans.ts - Added duplicate order key handling in reorderLesson and reorderSection

**Blockers**: None

---

## Issue #115: Remove fractional indexing from plans area

**Task completed**: Replaced fractional indexing with simple integer-based ordering for plans

**Key decisions**:
- Changed `order` field from `string` to `number` in Section and Lesson types
- Removed `fractional-indexing` import from use-plans.ts (library still used elsewhere for videos)
- Reordering now uses array-based splice/insert then reassigns sequential integers (0, 1, 2...)
- Adding new items uses `Math.max(...orders) + 1` instead of generateKeyBetween
- Simpler, bug-free approach since all data is in local state anyway

**Files changed**:
- app/features/course-planner/types.ts - Changed order from string to number
- app/hooks/use-plans.ts - Removed fractional-indexing, rewrote reorder functions
- app/routes/plans.$planId.tsx - Changed sorting from localeCompare to numeric comparison

**Blockers**: None

---

## Issue #114: Show sidebar on plans pages

**Task completed**: Added AppSidebar to plan detail and lesson detail pages

**Key decisions**:
- Made AppSidebar props optional with default empty arrays/null values
- Added optional chaining for setIsAddRepoModalOpen and setIsAddStandaloneVideoModalOpen
- Conditionally render AddRepoModal and AddStandaloneVideoModal only when their setters are provided
- Plans section of sidebar works standalone via usePlans hook (localStorage)

**Files changed**:
- app/components/app-sidebar.tsx - Made all props optional with defaults
- app/routes/plans.$planId.tsx - Added AppSidebar to both normal and "not found" returns
- app/routes/plans.$planId.lessons.$lessonId.tsx - Added AppSidebar to both normal and "not found" returns

**Blockers**: None

---

## Issue #113: Hide add section input behind plus button

**Task completed**: Changed add section UI from always-visible input to button that reveals input on click

**Key decisions**:
- Added `isAddingSectionOpen` state to control visibility
- Default state shows a dashed outline button with "Add Section" text
- Clicking button reveals input with Add/Cancel buttons
- Escape key cancels and hides the input
- Enter key submits (existing behavior)
- Input closes automatically after successful add

**Files changed**:
- app/routes/plans.$planId.tsx - Added isAddingSectionOpen state, updated add section UI with conditional rendering

**Blockers**: None

---

## Issue #116: Fix cross-section lesson drag to specific position

**Task completed**: Improved collision detection to allow dropping lessons at specific positions in other sections

**Key decisions**:
- Created custom collision detection that combines `pointerWithin` and `closestCenter`
- Prioritizes lessons over sections when pointer is inside a lesson element
- Added `data: { type: "section" }` to section sortables to distinguish them from lessons
- When dragging over a lesson in another section, that lesson is detected as the drop target

**Files changed**:
- app/routes/plans.$planId.tsx - Added customCollisionDetection function, marked sections with type data

**Blockers**: None

---

## Issue #117: Focus Add Lesson button after creating lesson/section

**Task completed**: Add Lesson button is now focused after creating a lesson or section for quick keyboard-driven workflows

**Key decisions**:
- Added `focusAddLessonInSection` state to track which section's button should be focused
- Added `shouldFocusAddLesson` and `onAddLessonFocused` props to SortableSection
- Used `useRef` and `useEffect` to focus the button when the flag is set
- Focus is triggered after both lesson creation (same section) and section creation (new section)

**Files changed**:
- app/routes/plans.$planId.tsx - Added focus logic with ref, state, and props threading

**Blockers**: None

---

## Issue #118: Replace lesson notes with inline description

**Task completed**: Replaced separate notes page with inline description editing on lessons

**Key decisions**:
- Renamed `notes` field to `description` in Lesson type
- Deleted lesson detail page (`plans.$planId.lessons.$lessonId.tsx`)
- Added inline description display/editing to SortableLesson component
- Description shows under lesson title (or "Add description" link if empty)
- Click on description or "Add description" opens textarea editor inline
- Supports Escape to cancel, Save/Cancel buttons

**Files changed**:
- app/features/course-planner/types.ts - Renamed notes to description
- app/hooks/use-plans.ts - Updated notes references to description
- app/routes/plans.$planId.tsx - Added inline description editing to lessons, removed Link to lesson detail
- Deleted: app/routes/plans.$planId.lessons.$lessonId.tsx

**Blockers**: None

---

## Issue #119: Hide edit buttons on hover, show grip handles always

**Task completed**: Adjusted visibility of edit/delete buttons and grip handles

**Key decisions**:
- Section edit/delete buttons: now hidden by default, visible on section hover (using group/section)
- Plan title edit button: now hidden by default, visible on hover (using group/title)
- Lesson grip handles: now always visible (removed opacity-0 group-hover:opacity-100)
- Lesson edit/delete buttons: remain hidden until hover (unchanged)

**Files changed**:
- app/routes/plans.$planId.tsx - Updated CSS classes for hover visibility

**Blockers**: None

---

## Issue #120: Rename repos to courses in sidebar

**Task completed**: Changed "Repos" to "Courses" in sidebar display

**Key decisions**:
- Simple text replacement in sidebar component
- Does not change any URLs or internal naming (as per requirements)

**Files changed**:
- app/components/app-sidebar.tsx - Changed "Repos" to "Courses", "Archived Repos" to "Archived Courses"

**Blockers**: None

---

## Issue #121: Add section numbers

**Task completed**: Added section numbers (1., 2., 3., etc.) next to section titles

**Key decisions**:
- Added `sectionNumber` prop to SortableSectionProps interface
- Pass `index + 1` when mapping over sortedSections
- Display number before title as muted-foreground text with "." suffix
- Numbers automatically update when sections are reordered

**Files changed**:
- app/routes/plans.$planId.tsx - Added sectionNumber prop and display

**Blockers**: None

---

## Issue #122: Ctrl+Space saves description

**Task completed**: Added Ctrl+Space keyboard shortcut to save description while editing

**Key decisions**:
- Added check for `e.key === " " && e.ctrlKey` in description textarea onKeyDown
- Prevents default behavior to avoid inserting space
- Consistent with escape-to-cancel pattern already in place

**Files changed**:
- app/routes/plans.$planId.tsx - Added Ctrl+Space handling in description Textarea

**Blockers**: None

---

## Issue #123: Add lesson numbers (1.1, 1.2, etc.)

**Task completed**: Added lesson numbers showing section.lesson format

**Key decisions**:
- Added `lessonNumber` prop to SortableLessonProps (string type for "1.1" format)
- Pass `${sectionNumber}.${lessonIndex + 1}` when mapping lessons
- Display number before lesson title in muted-foreground style
- Numbers update automatically when lessons are reordered or moved between sections

**Files changed**:
- app/routes/plans.$planId.tsx - Added lessonNumber prop and display

**Blockers**: None

---

## Issue #124: Add lesson icon selector

**Task completed**: Added clickable icon to lessons for choosing between watch (passive) and code (interactive) lesson types

**Key decisions**:
- Added `LessonIcon` type ("watch" | "code") and optional `icon` field to Lesson type
- Monitor icon = passive exercise (sit back and watch), Code icon = interactive (hands-on coding)
- Default is "watch" (Monitor icon) when no icon is set
- Click icon to toggle between the two options
- Icon appears between grip handle and lesson number
- Hover shows tooltip explaining the current state and that it's clickable

**Files changed**:
- app/features/course-planner/types.ts - Added LessonIcon type and icon field to Lesson
- app/hooks/use-plans.ts - Updated updateLesson to allow icon updates
- app/routes/plans.$planId.tsx - Added icon selector UI with Monitor and Code icons from lucide-react

**Blockers**: None

---

## Issue #125: Reduce Add Lesson button to plus icon only

**Task completed**: Changed Add Lesson button from text + icon to icon-only

**Key decisions**:
- Changed button from `size="sm"` to `size="icon"` with `h-6 w-6` dimensions
- Removed "Add Lesson" text, kept only the Plus icon
- Cleaner, less cluttered UI while maintaining functionality

**Files changed**:
- app/routes/plans.$planId.tsx - Simplified Add Lesson button to icon-only

**Blockers**: None

---

## Issue #126: Reposition lesson icon and make it brighter

**Task completed**: Moved lesson icon after the number and changed color to foreground

**Key decisions**:
- Reordered elements: grip → number → icon → title (was: grip → icon → number → title)
- Changed icon color from `text-muted-foreground` to `text-foreground` for better visibility
- Separated number into its own span element for cleaner layout

**Files changed**:
- app/routes/plans.$planId.tsx - Reordered lesson elements and updated icon color

**Blockers**: None

---

## Issue #127: Move lesson icon to separate column

**Task completed**: Refactored lesson layout to two-column design with prominent icon on left

**Key decisions**:
- Changed SortableLesson from single-row layout to two-column layout using flex with gap-3
- Left column: Large clickable icon (w-6 h-6, up from w-4 h-4) aligned to top of content
- Right column: Title row (grip, number, title, edit buttons) and description below
- Icon spans both title and description visually, creating a more prominent presence
- Removed `ml-6` indentation from description since it now aligns naturally under title
- Added `self-start mt-0.5` to icon button for proper vertical alignment with title text

**Files changed**:
- app/routes/plans.$planId.tsx - Restructured SortableLesson component layout

**Blockers**: None

---

## Issue #128: Create icon prototype page with multiple treatments

**Task completed**: Created prototype page at /icon-prototype with four different icon treatments

**Key decisions**:
- Variant 1 (Current): Large 24px icon in separate left column - prominent and visual
- Variant 2 (Inline Small): Small 16px icon inline between number and title - subtle and compact
- Variant 3 (Colored Badge): Icon with colored background (blue for code, purple for watch)
- Variant 4 (Labeled Pill): Small pill with icon + text label after title - explicit but verbose
- Page includes both a grid comparison and full section preview for each variant
- Used mock data with 4 lessons showing both icon types and with/without descriptions

**Files changed**:
- app/routes/icon-prototype.tsx - New prototype page with 4 icon treatment variants

**Blockers**: None

---

## Issue #128: Implement Circle Badge icon design and remove prototype

**Task completed**: Applied Circle Badge design to plan page and deleted prototype

**Key decisions**:
- Chose Circle Badge variant (Variant 12 from expanded prototype with 12 options)
- Layout: grip handle → circle badge icon → number + title
- Icon in 28px colored circle: yellow (`bg-yellow-500/20 text-yellow-600`) for code, purple (`bg-purple-500/20 text-purple-600`) for watch
- Uses Code and Play icons
- Deleted prototype page after design was finalized

**Files changed**:
- app/routes/plans.$planId.tsx - Updated SortableLesson to Circle Badge layout
- app/routes/icon-prototype.tsx - Deleted

**Blockers**: None

---

## Issue #130: Add third icon (green discussion/conversation)

**Task completed**: Added a third lesson icon type for discussions, colored green

**Key decisions**:
- Extended `LessonIcon` type to include "discussion" alongside "watch" and "code"
- Used `MessageCircle` icon from lucide-react for the discussion type
- Green color scheme: `bg-green-500/20 text-green-600` (consistent with existing yellow/purple pattern)
- Icon click cycles through: watch → code → discussion → watch
- Tooltip shows "Discussion (click to change)" for the new icon type

**Files changed**:
- app/features/course-planner/types.ts - Added "discussion" to LessonIcon type
- app/routes/plans.$planId.tsx - Added MessageCircle import, updated icon rendering and cycle logic

**Blockers**: None

---

## Issue #129: Add ability to duplicate a plan with context menu

**Task completed**: Added actions dropdown menu to plan title with Edit Title and Duplicate Plan options

**Key decisions**:
- Replaced pencil icon next to plan title with a MoreVertical icon triggering a dropdown menu
- Dropdown menu contains "Edit Title" (existing functionality, now in menu) and "Duplicate Plan" (new)
- Added `duplicatePlan` function to `usePlans` hook that deep copies plan with all sections and lessons
- Duplicated plan gets title suffixed with "(Copy)" and new IDs for all sections/lessons
- After duplication, user is navigated to the new plan

**Files changed**:
- app/hooks/use-plans.ts - Added duplicatePlan function
- app/routes/plans.$planId.tsx - Replaced pencil Button with DropdownMenu, added duplicate functionality

**Blockers**: None

