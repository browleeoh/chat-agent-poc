## Issue #44 - Sticky clip section headers in video editor
- Added CSS sticky positioning to ClipSectionDivider component
- When scrolling through the timeline, the current section header now sticks to the top of the viewport
- Implementation: Added `sticky top-0 z-10 bg-gray-900` classes to ClipSectionDivider button
- Background color ensures section header obscures content scrolling underneath
- z-index ensures section header stays on top of clips
- Key decision: Used native CSS sticky positioning rather than JavaScript scroll listeners for better performance
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/features/video-editor/video-editor.tsx:1465

## Issue #47 - Selective section inclusion in Write Article page
- Added ability to selectively include/exclude clip sections in AI prompts
- Write page now shows section checkboxes (only visible when video has clip sections)
- Each section checkbox shows word count for that section
- Main transcript toggle still works - can turn entire transcript off/on
- Implementation details:
  - Loader calculates word count per section while building transcript
  - Added `sectionsWithWordCount` array with id, name, order, and wordCount
  - Added `enabledSections` state (Set<string>) - defaults to all sections enabled
  - Added ScrollArea with section checkboxes showing name and word count
  - Updated completions endpoint schema to accept `enabledSections: string[]`
  - Updated `acquireTextWritingContext` to accept and filter by `enabledSections`
  - Transcript building now filters clips based on enabled sections
  - Maintains section headers (H2) for enabled sections only
- Key decisions:
  - Used same ASCII ordering logic as video editor for consistency
  - Clips before first section are included if no sections exist or all enabled
  - Section filtering works independently from file selection
  - Word counts calculated in loader to avoid recalculation on every render
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/routes/videos.$videoId.write.tsx (loader, UI, state, handler)
  - app/routes/videos.$videoId.completions.ts (schema, action)
  - app/services/text-writing-agent.ts (acquireTextWritingContext signature and logic)

## Issue #48 - Fixed section checkboxes overflowing into file tree
- Fixed visual bug where section checkboxes were overlapping with files in context
- Changed ScrollArea from `max-h-48` to fixed `h-48` height
- Wrapped ScrollArea in container with `shrink-0` to prevent height collapse
- Key decisions:
  - Fixed height ensures consistent layout and prevents overflow
  - shrink-0 prevents flex container from collapsing the section area
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/routes/videos.$videoId.write.tsx:501-502

## Issue #49 - Transcript checkbox controls section checkboxes
- Implemented parent-child checkbox relationship between transcript and sections
- Transcript checkbox now shows indeterminate state when some sections selected
- Clicking transcript checkbox toggles all section checkboxes
- Implementation details:
  - Transcript checkbox state derived from enabledSections count when sections exist
  - Shows true when all sections enabled, indeterminate when some enabled, false when none
  - Clicking transcript checkbox sets/clears all sections at once
  - Section checkboxes indented with pl-6 to show parent-child relationship visually
  - Submit handler derives includeTranscript from enabledSections when sections exist
- Key decisions:
  - Matches FileTree behavior for nested folder checkboxes (indeterminate state)
  - Maintains backward compatibility for videos without sections (uses includeTranscript state)
  - Visual indentation makes hierarchy clear to users
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/routes/videos.$videoId.write.tsx:483-553

## Issue #50 - Remove smooth scroll when clicking section links in video editor
- Changed scroll behavior from "smooth" to "instant" when clicking section links in sidebar
- When clicking a section in the sidebar, the timeline now scrolls instantly to that section
- Key decision: Changed window.scrollTo behavior property from "smooth" to "instant" for immediate navigation
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/features/video-editor/video-editor.tsx:867

## Issue #51 - Fix section scrolling broken by Issue #50
- Fixed regression where clicking section links in sidebar stopped working
- Root cause: Section frontendIds change on every re-render, so getElementById couldn't find the element after dispatch triggered re-render
- Solution: Use section index instead of ID to find elements, since order is stable
- Implementation details:
  - Changed from getElementById with dynamic ID to querySelectorAll with index lookup
  - Wrapped scroll in requestAnimationFrame to wait for React re-render to complete
  - Restored smooth scroll behavior (behavior: "smooth") for better UX
  - Changed block positioning to "center" instead of "start" for better visibility
- Key decisions:
  - Index-based lookup is more robust than ID-based when IDs are unstable
  - requestAnimationFrame ensures DOM is updated before scrolling
  - Smooth scroll provides better user experience than instant scroll
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/features/video-editor/video-editor.tsx:850-870

## Issue #50 - Remove smooth scroll when clicking section links (re-implementation)
- Changed scroll behavior from "smooth" to "instant" when clicking section links in sidebar
- When clicking a section in the sidebar, the timeline now scrolls instantly to that section
- This reverses the smooth scroll behavior that was restored in Issue #51
- Key decision: Changed scrollIntoView behavior property from "smooth" to "instant" for immediate navigation as requested in issue #50
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/features/video-editor/video-editor.tsx:866

## Issue #52 - Repo Archiving (Part 1: Database and API infrastructure)
- Added `archived` boolean field to repos table schema (defaults to false)
- Created POST /api/repos/:repoId/archive endpoint to toggle archive status
- Updated `getRepos()` to filter out archived repos (only returns non-archived)
- Added `getArchivedRepos()` query function to fetch archived repos
- Added `updateRepoArchiveStatus()` method to DBService
- Implementation details:
  - Used same pattern as existing clip/clipSection archiving
  - Archive endpoint accepts `{ archived: true|false }` body
  - Database schema change requires `npm run db:push` in production
- Key decisions:
  - Archive field with default false ensures backward compatibility
  - Separate query functions for active vs archived repos keeps code clear
  - Archive is soft delete - repos remain in database
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/db/schema.ts:40 (added archived field)
  - app/services/db-service.ts:930-945 (updated getRepos, added getArchivedRepos)
  - app/services/db-service.ts:1344-1365 (added updateRepoArchiveStatus)
  - app/routes/api.repos.$repoId.archive.ts (new endpoint)

## Issue #52 - Repo Archiving (Part 2: UI implementation)
- Added right-click context menu to repo items in sidebar with "Archive" option
- Created `/archived-repos` page route to display archived repos
- Added "Archived Repos" link to sidebar navigation
- Implementation details:
  - Wrapped repo buttons in ContextMenu with ContextMenuTrigger
  - Added archiveRepoFetcher to submit archive requests
  - Created new archived-repos.tsx route with loader to fetch archived repos
  - Archive page shows repo name and filePath with "Unarchive" button
  - Added Archive icon import from lucide-react
  - Sidebar link placed between Videos collapsible and Diagram Playground
- Key decisions:
  - Used existing ContextMenu pattern from lessons/videos for consistency
  - Archive context menu item submits to /api/repos/:repoId/archive endpoint
  - Unarchive button on archived page sets archived: false via same endpoint
  - Empty state message when no archived repos exist
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/routes/_index.tsx:51,267,329-364,410-416 (added Archive icon, archiveRepoFetcher, context menu, sidebar link)
  - app/routes/archived-repos.tsx (new page)

## Issue #53 - Fix repo archiving 400 error
- Fixed bug where archiving/unarchiving repos returned 400 error
- Root cause: UI was submitting archived as string ("true"/"false") but schema expected boolean
- Solution: Updated schema to accept string literals "true"/"false" and transform to boolean
- Implementation details:
  - Changed schema from `Schema.Boolean` to `Schema.Literal("true", "false").pipe(Schema.transform(Schema.Boolean, ...))`
  - Transform decodes "true" to true and "false" to false
  - Transform encodes boolean back to string literal for type safety
- Key decision: Fix schema to accept form data strings rather than changing UI to convert strings to booleans
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/routes/api.repos.$repoId.archive.ts:8-15

## Issue #56 - Show sidebar on archived repos page
- Added full sidebar structure to archived repos page matching main index page
- Root cause: archived-repos.tsx only rendered content without sidebar wrapper
- Implementation details:
  - Added sidebar with Repos and Videos collapsible sections
  - Repos section shows all non-archived repos with archive context menu
  - Videos section shows standalone videos with add video button
  - Added Archived Repos and Diagram Playground navigation links
  - Loader now fetches repos and standaloneVideos in addition to archivedRepos
  - Added necessary state management (isAddRepoModalOpen, isAddStandaloneVideoModalOpen)
  - Added modals for adding repos and videos (AddRepoModal, AddStandaloneVideoModal)
  - Sidebar maintains consistent navigation experience across pages
- Key decisions:
  - Duplicated sidebar structure instead of extracting component to keep task simple and focused
  - Used same layout pattern as _index.tsx (flex container with sidebar and main content)
  - Repos in sidebar navigate to main index page with repoId query param
  - Archive functionality works from sidebar context menu on archived repos page
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/routes/archived-repos.tsx:1-257

## Issue #55 - Move archived repos link under repos section in sidebar
- Moved "Archived Repos" link from standalone section to inside Repos collapsible section
- Updated both _index.tsx and archived-repos.tsx for consistency
- Implementation details:
  - Changed from standalone Link with custom styling to Button inside CollapsibleContent
  - Archived Repos now appears after the list of repos within the Repos section
  - Styled as muted text like "View All Videos" to indicate it's a navigation link
  - Removed the standalone "Archived Repos" section that was at the same level as "Diagram Playground"
  - Now follows visual hierarchy: repos listed first, then archived repos link at bottom of section
- Key decisions:
  - Used Button component with ghost variant matching "View All Videos" pattern
  - Maintains ml-6 indentation consistent with other items in CollapsibleContent
  - Archive icon size changed from w-5 h-5 to w-4 h-4 with mr-2 spacing for consistency
  - Link now collapses/expands with the Repos section
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/routes/_index.tsx:367-377,421-428
  - app/routes/archived-repos.tsx:135-145,181-188

## Issue #57 - Remove add repo button from sidebar
- Removed the Plus icon button from Repos section header in sidebar
- Updated both _index.tsx and archived-repos.tsx for consistency
- Implementation details:
  - Removed the Button with Plus icon that was next to "Repos" CollapsibleTrigger
  - Removed the wrapping div with "flex items-center justify-between" layout
  - CollapsibleTrigger now stands alone without the add button
  - AddRepoModal component and state management remain for other entry points (e.g., empty state in main content)
- Key decisions:
  - Kept the AddRepoModal functionality intact - can still be triggered from other UI locations
  - Simplified Repos section header to just the collapsible trigger
  - Users can still add repos via the empty state button in the main content area
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/routes/_index.tsx:311-315
  - app/routes/archived-repos.tsx:79-83

## Issue #54 - Add archive/unarchive to actions menu on repo page
- Added Archive/Unarchive option to Actions dropdown menu on repo page
- Menu item dynamically shows "Archive Course" or "Unarchive Course" based on current state
- Implementation details:
  - Added new DropdownMenuItem in Course section of Actions menu
  - Uses existing archiveRepoFetcher to submit to /api/repos/:repoId/archive endpoint
  - Conditionally toggles archived state: sends "true" if not archived, "false" if archived
  - Menu text changes based on currentRepo.archived property
  - Description changes: "Hide course from main view" when archiving, "Restore course to active repos" when unarchiving
  - Uses Archive icon from lucide-react
- Key decisions:
  - Placed in Course section alongside other course-level actions (Rename, Rewrite Path)
  - Dynamic text provides clear indication of current state and action
  - Uses same API endpoint and pattern as sidebar context menu for consistency
  - No confirmation dialog (matches other menu actions like rename)
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/routes/_index.tsx:550-573

## Issue #59 - Make archived repo names clickable to navigate to repo view
- Made repo names on archived repos page clickable to navigate to repo view
- Implementation details:
  - Changed repo name from plain h3 text to Button with variant="link"
  - onClick handler navigates to `/?repoId=${repo.id}` with preventScrollReset
  - Styled with "h-auto p-0 font-medium text-base" to maintain heading appearance
  - Uses same navigation pattern as sidebar repo buttons
- Key decisions:
  - Used Button component for consistency with rest of app navigation
  - link variant provides underline-on-hover behavior typical of links
  - Maintains font-medium styling to preserve visual hierarchy
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/routes/archived-repos.tsx:219-229

## Issue #60 - Restore + button next to Repos, confirm removal of large Add repo button
- Restored the + icon button next to "Repos" in sidebar header on both pages
- Confirmed that large "Add Repo" button at bottom (below Separator) is already removed
- Implementation details:
  - Added back the wrapper div with "flex items-center justify-between" layout
  - Added Plus icon button (h-7 w-7, ghost variant) that opens AddRepoModal
  - Matches the Videos section pattern for consistency
  - Updated both _index.tsx and archived-repos.tsx
- Key decisions:
  - The large wide "Add Repo" button was previously removed from sidebar bottom
  - Small + icon provides quick access while maintaining clean UI
  - Consistent pattern across Repos and Videos sections
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/routes/_index.tsx:311-325
  - app/routes/archived-repos.tsx:79-93

## Issue #58 - Extract sidebar into shared component
- Created AppSidebar component to eliminate duplication between pages
- Sidebar was duplicated between _index.tsx and archived-repos.tsx
- Implementation details:
  - Created app/components/app-sidebar.tsx with all sidebar logic
  - Component accepts repos, standaloneVideos, selectedRepoId, and modal state as props
  - Repos, Videos, and Diagram Playground navigation in shared component
  - Archive functionality and modals included in component
  - Updated both _index.tsx and archived-repos.tsx to use AppSidebar
  - Removed duplicate sidebar code (140+ lines per file)
  - Cleaned up unused imports (Collapsible, Separator, various icons)
- Key decisions:
  - Navigation to repos uses absolute path (/?repoId=) for consistency across pages
  - All modal state management remains in parent components for flexibility
  - Component is self-contained with its own archiveRepoFetcher
  - Maintains exact same UI and behavior as before
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/components/app-sidebar.tsx (new file, 213 lines)
  - app/routes/_index.tsx (removed 140 lines, added AppSidebar usage)
  - app/routes/archived-repos.tsx (removed 140 lines, added AppSidebar usage)

## Issue #60 - Remove unwanted Add Repo button from sidebar
- Removed DialogTrigger button from AddRepoModal component that was rendering a large "Add Repo" button
- Removed unnecessary Separator from AppSidebar since there's no content below it
- Root cause: AddRepoModal had both a DialogTrigger button (unintended) and external control via isOpen prop (intended)
- Implementation details:
  - Removed DialogTrigger import from AddRepoModal
  - Removed DialogTrigger JSX wrapper and the "Add Repo" Button it contained
  - Modal is now purely controlled by the isOpen prop, triggered by the + icon in sidebar header
  - Removed unused Separator and its import from AppSidebar component
- Key decisions:
  - DialogTrigger was rendering an unnecessary trigger button when the modal is externally controlled
  - Small + icon button next to "Repos" header remains as the intended way to open the modal
  - Separator removed for cleaner UI without orphaned dividers
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/components/add-repo-modal.tsx:1-36 (removed DialogTrigger import and button)
  - app/components/app-sidebar.tsx:15,183 (removed Separator import and element)
## Issue #61 - Archive Standalone Videos
- Added archive functionality for standalone videos mirroring the existing archive repos feature
- Archived videos are hidden from sidebar but accessible in view-all-videos page in separate section
- Database and API infrastructure:
  - Added `archived` boolean field to videos table schema (defaults to false)
  - Created POST /api/videos/:videoId/archive endpoint with lessonId verification
  - Endpoint verifies video is standalone (lessonId is NULL) before allowing archive
  - Updated getStandaloneVideos() to filter out archived videos (only returns non-archived)
  - Added getArchivedStandaloneVideos() query function for archived videos
  - Added updateVideoArchiveStatus() method to DBService with lessonId verification
  - Created CannotArchiveLessonVideoError for attempting to archive lesson-attached videos
- UI implementation:
  - Added archive context menu to sidebar standalone videos (right-click to archive)
  - Updated view-all-videos page to load both non-archived and archived videos
  - Non-archived videos shown at top, archived videos in separate section below
  - Archive/Unarchive option in context menu on view-all-videos page
  - Archived section hidden when there are no archived videos
  - Archive icon imported from lucide-react
- Key decisions:
  - Archive is soft delete - videos remain in database with archived flag
  - Lesson-attached videos are protected from archiving at API level
  - Clips and clip sections within archived videos retain their own archive state independently
  - Used same pattern as repos archiving (string "true"/"false" schema transform to boolean)
  - No separate "Archived Videos" page needed (unlike repos)
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/db/schema.ts:119 (added archived field to videos table)
  - app/services/db-service.ts:650,664-679,967,1418-1422 (updated getStandaloneVideos, added getArchivedStandaloneVideos and updateVideoArchiveStatus)
  - app/services/db-service-errors.ts:39-44 (added CannotArchiveLessonVideoError)
  - app/routes/api.videos.$videoId.archive.ts (new endpoint)
  - app/components/app-sidebar.tsx:53,152-179 (added archive context menu to sidebar videos)
  - app/routes/videos._index.tsx:17,19,32,45,59,65,143-172,174-236 (added archived videos section and context menus)

## Issue #62 - Remove archive icon from archived repos link
- Removed Archive icon from "Archived Repos" link in sidebar
- Link now displays just text without icon for cleaner appearance
- Key decision: Keeps visual hierarchy clean and reduces icon clutter
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/components/app-sidebar.tsx:124

## Issue #63 - Make Videos section default open in sidebar
- Added defaultOpen attribute to Videos Collapsible component in sidebar
- Videos section now expands by default matching Repos section behavior
- Key decision: Improves discoverability of standalone videos in sidebar
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- File changed: app/components/app-sidebar.tsx:132

## Issue #64 - Progressive Disclosure Refactor - Phase 1: Extract clip-utils.ts
- Extracted clip utility functions from video-editor.tsx into new clip-utils.ts file
- Moved calculateTextSimilarity, isClip, and isClipSection functions
- Implementation details:
  - Created app/features/video-editor/clip-utils.ts with 3 utility functions
  - calculateTextSimilarity uses Levenshtein distance to calculate text similarity percentage
  - isClip and isClipSection are type guards for TimelineItem discrimination
  - Added JSDoc comments for better documentation
  - Updated video-editor.tsx to import from clip-utils instead of defining locally
  - Removed unused ClipSection type import from video-editor.tsx
- Key decisions:
  - Created separate clip-utils.ts file instead of adding to existing utils.ts
  - Maintained all existing function signatures and behavior (no breaking changes)
  - Type guards remain as arrow functions for consistency with existing code style
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/features/video-editor/clip-utils.ts (new file)
  - app/features/video-editor/video-editor.tsx:33-34,63-76 (removed function definitions, added import)

## Issue #64 - Progressive Disclosure Refactor - Phase 1: Create types.ts files
- Created types.ts files in video-editor and article-writer feature directories
- Extracted type definitions to reduce inline complexity in large TSX files
- Implementation details:
  - Created app/features/video-editor/types.ts with 4 type definitions:
    - ClipSectionNamingModal: State for clip section naming modal (create/edit/add-at modes)
    - ClipComputedProps: Map of clip IDs to computed properties (timecode, Levenshtein)
    - ClipSectionDividerProps: Props for ClipSectionDivider component
    - LiveMediaStreamProps: Props for LiveMediaStream component
  - Created app/features/article-writer/types.ts with 3 type definitions:
    - SectionWithWordCount: Clip sections with word counts for UI display
    - Mode: Writing mode for article writer (extends TextWritingAgentMode)
    - Model: AI model selection (Sonnet 4.5 or Haiku 4.5)
  - Updated video-editor.tsx to import and use types from types.ts
  - Updated videos.$videoId.write.tsx to import and use types from types.ts
  - Removed inline type definitions from both files
- Key decisions:
  - Prioritized types used by multiple functions or representing core data structures
  - Added JSDoc comments for better documentation
  - _index.tsx does not need types.ts (uses inferred types from database queries)
  - Kept types within feature directories for better organization
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/features/video-editor/types.ts (new file)
  - app/features/article-writer/types.ts (new file)
  - app/features/video-editor/video-editor.tsx:34-39,278-279,390,1429-1431,1456 (added import, updated type usage)
  - app/routes/videos.$videoId.write.tsx:5,146,279 (added import, removed inline types)

## Issue #64 - Progressive Disclosure Refactor - Phase 2: Extract timeline-indicators.tsx
- Extracted small presentational components from video-editor.tsx into timeline-indicators.tsx
- Moved InsertionPointIndicator, BeatIndicator, and RecordingSignalIndicator components
- Implementation details:
  - Created app/features/video-editor/components/timeline-indicators.tsx with 3 components
  - InsertionPointIndicator: Visual indicator showing where new clips will be inserted (blue dashed line with plus icon)
  - BeatIndicator: Visual indicator showing beat/pause between clips (three gray dots)
  - RecordingSignalIndicator: Visual indicator showing recording in progress (pulsing red circle)
  - Added JSDoc comments for better documentation
  - Updated video-editor.tsx to import from timeline-indicators instead of defining locally
  - Removed INSERTION_POINT_ID import from video-editor.tsx (now only used in timeline-indicators)
- Key decisions:
  - Created components/ subdirectory within video-editor feature for extracted components
  - Maintained all existing component signatures and behavior (no breaking changes)
  - Components remain as simple presentational components with no props (except InsertionPointIndicator uses INSERTION_POINT_ID constant)
  - video-editor.tsx reduced from 1,560 to 1,529 lines (31 lines saved)
- All tests pass (21 passed, 1 todo)
- TypeScript typechecks pass
- Files changed:
  - app/features/video-editor/components/timeline-indicators.tsx (new file, 48 lines)
  - app/features/video-editor/video-editor.tsx:40-44,94 (added import, removed INSERTION_POINT_ID import, removed 3 component definitions)
