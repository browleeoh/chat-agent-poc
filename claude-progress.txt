## 2026-01-01: Clone database to local Docker script

Created script to clone production database to a local Docker container for migration testing. This allows safe testing of migrations before running on production.

Changes:
- scripts/clone-db-to-local.sh: New script that creates/starts Docker PostgreSQL container, dumps prod, restores to local
- package.json: Added db:clone-local script

Usage:
- pnpm db:clone-local
- Clones to localhost:5433 with password "localpassword"

## 2026-01-01: Repo updates only affect latest version

Modified the repo update API to only modify sections/lessons in the latest version. When a repo is updated via /api/repos/update, the system now fetches only the latest version's sections and creates new sections with the correct repoVersionId. Older versions remain untouched.

Changes:
- app/services/db-service.ts: Added getRepoWithSectionsByVersion to fetch repo sections filtered by version
- app/routes/api.repos.update.ts: Get latest version first, filter sections by version, pass repoVersionId to createSections

## 2026-01-01: Backend rejects creating version from non-latest version

Added backend validation to prevent creating new versions from non-latest versions. This ensures data integrity even if the UI fails to hide the option.

Changes:
- app/services/db-service.ts: Added NotLatestVersionError, validation in copyVersionStructure that checks sourceVersionId is latest
- app/routes/api.repos.$repoId.create-version.ts: Handle NotLatestVersionError with 400 response

## 2026-01-01: Create Version visibility based on latest version

Added `isLatestVersion` flag to loader that compares selected version ID with the first (latest) version in the list. The "Create New Version" dropdown option now only shows when viewing the latest version.

Changes:
- app/routes/_index.tsx: Added isLatestVersion calculation in loader, conditional render of Create New Version menu item

## 2026-01-01: Verified all versions remain editable

Confirmed that clip editing works across all versions. Clip update/archive endpoints operate on clip IDs directly with no version restrictions. Each version has its own independent copy of clips (via section → lesson → video → clip hierarchy), so edits in one version don't affect other versions.

No code changes needed - functionality already implemented correctly.

## 2026-01-01: Version selector moved to top bar

Moved version display and selection from sidebar to top bar next to course title. Version now shows in brackets after course name and clicking opens a modal to select versions.

Changes:
- app/components/version-selector-modal.tsx: New modal component listing all versions with checkmark for selected
- app/routes/_index.tsx: Added clickable version badge in h1, added VersionSelectorModal, removed sidebar version dropdown

Tests now passing:
- Version displays in top bar next to course title
- Switching versions updates displayed content
- Version selector modal shows versions ordered by date descending
- Version selector is NOT displayed in sidebar
- URL reflects selected version
- Default to latest version when no versionId in URL
- Versions cannot be deleted (no delete UI/endpoint exists)

## 2026-01-01: Version only visible when multiple versions exist

Added conditional check to only show version badge in top bar when repo has more than one version. Single-version repos no longer show the version indicator, reducing UI clutter.

Changes:
- app/routes/_index.tsx: Added `data.versions.length > 1` check to version badge render condition

## 2026-01-01: Rename Version via Actions dropdown

Implemented "Rename Version" feature accessible from Actions dropdown. Opens modal with current version name pre-filled, saves via API.

Changes:
- app/services/db-service.ts: Added `updateRepoVersionName` method
- app/routes/api.repos.$repoId.rename-version.ts: New API route for version renaming
- app/components/rename-version-modal.tsx: New modal component with form
- app/routes/_index.tsx: Added Rename Version action to dropdown, integrated modal

## 2026-01-01: Rename Course via Actions dropdown

Implemented "Rename Course" feature accessible from Actions dropdown. Opens modal with current repo name pre-filled, saves via API. Name updates in top bar and sidebar after refresh.

Changes:
- app/services/db-service.ts: Added `updateRepoName` method
- app/routes/api.repos.$repoId.rename-repo.ts: New API route for repo renaming
- app/components/rename-repo-modal.tsx: New modal component with form
- app/routes/_index.tsx: Added Rename Course action to dropdown, integrated modal
