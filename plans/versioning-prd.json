[
  {
    "category": "functional",
    "description": "Version displays in top bar next to course title",
    "steps": [
      "Select a repo from the sidebar",
      "Verify version appears in brackets next to course title in top bar",
      "Click the version text",
      "Verify modal opens with version selector",
      "Verify modal lists all versions for the repo"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Version only visible in UI when multiple versions exist",
    "steps": [
      "Select a repo with only one version",
      "Verify version is NOT shown in top bar",
      "Create a second version for the repo",
      "Verify version now appears in top bar",
      "Verify clicking version opens modal"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Switching versions updates displayed content",
    "steps": [
      "Select a repo with multiple versions",
      "Note the current sections/lessons displayed",
      "Click version in top bar to open modal",
      "Select a different version from modal",
      "Verify modal closes and URL updates with versionId param",
      "Verify displayed sections/lessons match selected version"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Create new version copies structure from current version",
    "steps": [
      "Select a repo with sections/lessons/videos/clips",
      "Open Actions dropdown",
      "Click 'Create New Version'",
      "Enter version name in modal",
      "Submit and verify new version is created",
      "Verify new version contains same sections/lessons/videos",
      "Verify non-archived clips are copied",
      "Verify archived clips are NOT copied"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Create new version moves video files from previous version",
    "steps": [
      "Select a repo with exported video files on file system",
      "Create a new version",
      "Verify video files renamed/moved to new version's paths",
      "Verify new version's video records point to moved files",
      "Verify previous version's video records updated (files no longer present)",
      "Verify no duplicate video files on file system"
    ],
    "passes": false
  },
  {
    "category": "functional",
    "description": "Create Version option only visible when viewing latest version",
    "steps": [
      "Select a repo with multiple versions",
      "Select the latest version",
      "Open Actions dropdown",
      "Verify 'Create New Version' option is visible",
      "Select an older version (not latest)",
      "Open Actions dropdown",
      "Verify 'Create New Version' option is NOT visible"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Backend rejects creating version from non-latest version",
    "steps": [
      "Create repo with v1.0 and v2.0",
      "Call createVersion API with v1.0's versionId",
      "Verify API returns error",
      "Verify no new version created"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "New version tracks references to previous version entities",
    "steps": [
      "Create a new version from existing version",
      "Check database: new sections have previousVersionSectionId set",
      "Check database: new lessons have previousVersionLessonId set",
      "Verify references point to correct source entities"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Repo updates only affect latest version",
    "steps": [
      "Create a repo with version v1.0",
      "Create version v2.0",
      "Trigger repo update via /api/repos/update",
      "Verify changes applied to v2.0 only",
      "Verify v1.0 remains unchanged"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "All versions remain editable",
    "steps": [
      "Select an older version (not latest)",
      "Edit a clip in that version",
      "Verify edit is saved successfully",
      "Switch to latest version",
      "Verify latest version clips unchanged"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Export generates full changelog with all version history",
    "steps": [
      "Create repo with v1.0",
      "Create v1.5 with some changes",
      "Create v2.0 with more changes",
      "Export/publish v2.0",
      "Verify changelog.md created in Dropbox folder",
      "Verify changelog shows v2.0 changes at top",
      "Verify changelog shows v1.5 changes below",
      "Verify changelog shows v1.0 as 'Initial version' at bottom"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Changelog shows version sections in reverse chronological order",
    "steps": [
      "Create multiple versions with different dates",
      "Export latest version",
      "Verify changelog has ## heading for each version",
      "Verify newest version appears first",
      "Verify oldest version appears last"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Changelog detects new lessons per version",
    "steps": [
      "Create v2.0 from v1.0",
      "Add new lesson (no previousVersionLessonId)",
      "Export",
      "Verify new lesson listed under v2.0's '### New Lessons'"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Changelog detects renamed sections/lessons per version",
    "steps": [
      "Create v2.0 from v1.0",
      "Change lesson path in v2.0",
      "Export",
      "Verify rename listed under v2.0's '### Renamed' with old â†’ new format"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Changelog detects content changes via transcript comparison",
    "steps": [
      "Create v2.0 from v1.0",
      "Modify clip transcript text in a lesson",
      "Export",
      "Verify lesson listed under v2.0's '### Content Changes'"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Initial version shows as 'Initial version' in changelog",
    "steps": [
      "Create repo with v1.0 as first version",
      "Create v2.0",
      "Export",
      "Verify v1.0 section shows 'Initial version' without change details"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Publish errors displayed via sonner toast",
    "steps": [
      "Install sonner package",
      "Add Toaster component to app root",
      "Trigger publish action that fails",
      "Verify error toast appears with failure reason",
      "Verify toast is dismissible"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Latest version can be deleted via Actions dropdown",
    "steps": [
      "Select a repo with multiple versions",
      "Select the latest version",
      "Open Actions dropdown",
      "Click 'Delete Version'",
      "Verify confirmation dialog appears",
      "Confirm deletion",
      "Verify version deleted from database",
      "Verify version's video files deleted from file system",
      "Verify UI redirects to previous version"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Delete Version disabled for non-latest versions",
    "steps": [
      "Select a repo with multiple versions",
      "Select an older version (not latest)",
      "Open Actions dropdown",
      "Verify 'Delete Version' option is visible but greyed out",
      "Verify tooltip/message explains 'Can only delete latest version'"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Backend rejects deleting non-latest version",
    "steps": [
      "Create repo with v1.0 and v2.0",
      "Call deleteVersion API with v1.0's versionId",
      "Verify API returns error",
      "Verify v1.0 still exists in database"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Cannot delete the only version of a repo",
    "steps": [
      "Select a repo with only one version",
      "Open Actions dropdown",
      "Verify 'Delete Version' option is visible but greyed out",
      "Verify tooltip/message explains 'Cannot delete only version'",
      "Verify backend rejects delete attempt for sole version"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Update version name via Actions dropdown",
    "steps": [
      "Select a repo with a version",
      "Open Actions dropdown",
      "Click 'Rename Version'",
      "Verify modal opens with current version name",
      "Enter new version name",
      "Submit and verify name updated in top bar",
      "Verify name persisted after page refresh"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Update repo name via Actions dropdown",
    "steps": [
      "Select a repo",
      "Open Actions dropdown",
      "Click 'Rename Course'",
      "Verify modal opens with current repo name",
      "Enter new repo name",
      "Submit and verify name updated in top bar",
      "Verify name updated in sidebar",
      "Verify name persisted after page refresh"
    ],
    "passes": true
  },
  {
    "category": "functional",
    "description": "Clear all videos from file system via Actions dropdown",
    "steps": [
      "Select a repo with multiple versions, each with videos",
      "Select a specific version",
      "Open Actions dropdown",
      "Click 'Clear Video Files'",
      "Verify confirmation dialog appears",
      "Confirm deletion",
      "Verify video files for selected version deleted from file system",
      "Verify video files for other versions remain on file system",
      "Verify database entries remain intact",
      "Verify UI still shows video metadata"
    ],
    "passes": true
  },
  {
    "category": "data",
    "description": "Clone database to local Docker for migration testing",
    "steps": [
      "Create script to clone prod database to local Docker container",
      "Script creates new PostgreSQL container if not exists",
      "Script dumps prod database and restores to local",
      "Run migration on local clone first",
      "Verify migration succeeded before running on prod"
    ],
    "passes": true
  },
  {
    "category": "data",
    "description": "Migration creates v1.0 for existing repos",
    "steps": [
      "Run database migration on existing data",
      "Verify each existing repo has a repoVersion record",
      "Verify version name is 'v1.0'",
      "Verify sections point to repoVersionId instead of repoId"
    ],
    "passes": true
  },
  {
    "category": "data",
    "description": "Cascade deletion works through version hierarchy",
    "steps": [
      "Create a repo with version, sections, lessons, videos, clips",
      "Delete the repo",
      "Verify all versions are deleted",
      "Verify all sections are deleted",
      "Verify all lessons/videos/clips are deleted"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Version selector modal shows versions ordered by date descending",
    "steps": [
      "Create multiple versions with different dates",
      "Click version in top bar to open modal",
      "Verify most recent version appears first in modal",
      "Verify versions are ordered newest to oldest"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Version selector is NOT displayed in sidebar",
    "steps": [
      "Select a repo from the sidebar",
      "Verify no version dropdown/selector in sidebar",
      "Verify sidebar only shows repo list"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Create version modal validates input",
    "steps": [
      "Open create version modal",
      "Try to submit with empty name",
      "Verify error or submit blocked",
      "Enter valid name",
      "Verify submit succeeds"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "URL reflects selected version",
    "steps": [
      "Select a repo and change version via top bar modal",
      "Verify URL contains repoId and versionId params",
      "Copy URL and open in new tab",
      "Verify same repo and version are selected"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Default to latest version when no versionId in URL",
    "steps": [
      "Navigate to URL with repoId but no versionId",
      "Verify latest version is automatically selected",
      "Verify top bar shows latest version in brackets"
    ],
    "passes": true
  }
]
